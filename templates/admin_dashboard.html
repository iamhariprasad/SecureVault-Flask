{% extends "base.html" %}
{% block content %}

<div class="page-header animate-slide-down">
    <h1 class="page-title">Admin Dashboard</h1>
    <p class="page-subtitle">Manage users and files</p>
</div>

{# Statistics #}
<div class="stats-grid animate-fade-in">
    <div class="stat-card">
        <div class="stat-label">Total Users</div>
        <div class="stat-value">{{ users|length }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Total Files</div>
        <div class="stat-value">{{ files|length }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Admin Status</div>
        <div class="stat-value" style="font-size: 1.5rem;">Active</div>
    </div>
</div>

{# Users Section #}
<div class="card animate-fade-in" style="margin-bottom: 2rem;">
    <h2 style="margin-bottom: 1.5rem; font-size: 1.5rem;">Registered Users</h2>
    
    {% if users|length == 0 %}
        <div class="empty-state" style="padding: 2rem;">
            <div class="empty-text">No users registered yet</div>
        </div>
    {% else %}
        <div style="display: grid; gap: 1rem;">
            {% for user in users %}
                <div style="padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-sm); border: 1px solid var(--border-color);">
                    <div class="flex-between">
                        <div>
                            <strong style="color: var(--accent-primary);">{{ user.username }}</strong>
                            {% if user.is_admin %}
                                <span class="user-badge" style="margin-left: 0.5rem;">Admin</span>
                            {% endif %}
                        </div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">
                            User ID: {{ user._id }}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>

{# Files Section #}
<div class="card animate-fade-in">
    <h2 style="margin-bottom: 1.5rem; font-size: 1.5rem;">All Uploaded Files</h2>
    
    {% if files|length == 0 %}
        <div class="empty-state" style="padding: 2rem;">
            <div class="empty-text">No files uploaded yet</div>
        </div>
    {% else %}
        <div class="files-grid">
            {% for file in files %}
                <div class="file-card">
                    <div class="file-icon">
                        {% set ext = file.original_filename.split('.')[-1]|lower if '.' in file.original_filename else '' %}
                    
                        {% if ext in ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'] %}
                            <img src="{{ url_for('static', filename='icons/image.png') }}" class="icon-img">
                    
                        {% elif ext in ['pdf'] %}
                            <img src="{{ url_for('static', filename='icons/pdf.png') }}" class="icon-img">
                    
                        {% elif ext in ['doc', 'docx'] %}
                            <img src="{{ url_for('static', filename='icons/word-file.png') }}" class="icon-img">
                    
                        {% elif ext in ['xls', 'xlsx', 'csv'] %}
                            <img src="{{ url_for('static', filename='icons/xls.png') }}" class="icon-img">
                    
                        {% elif ext in ['ppt', 'pptx'] %}
                            <img src="{{ url_for('static', filename='icons/ppt.png') }}" class="icon-img">
                    
                        {% elif ext in ['mp3', 'wav', 'aac', 'flac', 'ogg'] %}
                            <img src="{{ url_for('static', filename='icons/musicpng.png') }}" class="icon-img">
                    
                        {% elif ext in ['mp4', 'mov', 'avi', 'mkv', 'wmv'] %}
                            <img src="{{ url_for('static', filename='icons/video.png') }}" class="icon-img">
                    
                        {% elif ext in ['zip', 'rar', '7z', 'tar', 'gz'] %}
                            <img src="{{ url_for('static', filename='icons/archive.png') }}" class="icon-img">
                    
                        {% else %}
                            <img src="{{ url_for('static', filename='icons/file.png') }}" class="icon-img">
                        {% endif %}
                    </div>
                    
                    
                    <div class="file-name">{{ file.original_filename }}</div>
                    
                    <div class="file-meta">
                        <span>User ID: {{ file.user_id }}</span>
                        {% if file.file_size %}
                            <span>{{ file.file_size|format_size }}</span>
                        {% endif %}
                        {% if file.uploaded_at %}
                            <span>{{ file.uploaded_at.strftime("%b %d, %Y") }}</span>
                        {% endif %}
                    </div>
                    
                    <form action="{{ url_for('admin.download_user_file', file_id=file._id) }}" method="POST" style="margin-top: 1rem;">
                        <input type="password" 
                               name="password" 
                               placeholder="File password" 
                               required 
                               class="form-input"
                               style="margin-bottom: 0.5rem;">
                        <button type="submit" class="btn btn-primary btn-sm" style="width: 100%;">
                            Download
                        </button>
                    </form>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>

{% endblock %}
